(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{311:function(e,a,t){"use strict";t.r(a);var s=t(8),n=Object(s.a)({},(function(){var e=this,a=e._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"install-basic-application-using-flux"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#install-basic-application-using-flux"}},[e._v("#")]),e._v(" Install basic application using Flux")]),e._v(" "),a("h2",{attrs:{id:"cert-manager"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cert-manager"}},[e._v("#")]),e._v(" cert-manager")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("envsubst "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" files/flux-repository/namespaces/cert-manager-ns.yaml     "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" tmp/k8s-flux-repository/namespaces/cert-manager-ns.yaml\nenvsubst "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" files/flux-repository/releases/cert-manager-release.yaml  "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" tmp/k8s-flux-repository/releases/cert-manager-release.yaml\nenvsubst "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" files/flux-repository/workloads/cert-manager-00-crds.yaml "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" tmp/k8s-flux-repository/workloads/cert-manager-00-crds.yaml\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-C")]),e._v(" tmp/k8s-flux-repository "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--verbose")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-C")]),e._v(" tmp/k8s-flux-repository commit "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-m")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Add cert-manager"')]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-C")]),e._v(" tmp/k8s-flux-repository push "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-q")]),e._v("\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("add 'namespaces/cert-manager-ns.yaml'\nadd 'releases/cert-manager-release.yaml'\nadd 'workloads/cert-manager-00-crds.yaml'\n[master 6284194] Add cert-manager\n 3 files changed, 1460 insertions(+)\n create mode 100644 namespaces/cert-manager-ns.yaml\n create mode 100644 releases/cert-manager-release.yaml\n create mode 100644 workloads/cert-manager-00-crds.yaml\n")])])]),a("p",[e._v("Let Flux to sync the configuration from git repository:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sleep")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("30")]),e._v("\nfluxctl "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sync")]),e._v("\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Synchronizing with git@github.com:ruzickap/k8s-flux-repository\nRevision of master to apply is 6284194\nWaiting for 6284194 to be applied ...\nDone.\n")])])]),a("p",[e._v("Create "),a("code",[e._v("ClusterIssuer")]),e._v(":")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("ROUTE53_AWS_SECRET_ACCESS_KEY_BASE64")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$(")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("echo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-n")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$ROUTE53_AWS_SECRET_ACCESS_KEY")]),e._v('"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" base64"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v(")")])]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("cat")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-f")]),e._v(" -")]),e._v("\napiVersion: v1\nkind: Secret\nmetadata:\n  name: aws-route53-secret-access-key-secret\n  namespace: cert-manager\ndata:\n  secret-access-key: "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$ROUTE53_AWS_SECRET_ACCESS_KEY_BASE64")]),e._v("\n---\napiVersion: certmanager.k8s.io/v1alpha1\nkind: ClusterIssuer\nmetadata:\n  name: letsencrypt-staging-dns\n  namespace: cert-manager\nspec:\n  acme:\n    server: https://acme-staging-v02.api.letsencrypt.org/directory\n    email: petr.ruzicka@gmail.com\n    privateKeySecretRef:\n      name: letsencrypt-staging-dns\n    dns01:\n      providers:\n      - name: aws-route53\n        route53:\n          accessKeyID: "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${ROUTE53_AWS_ACCESS_KEY_ID}")]),e._v("\n          region: eu-central-1\n          secretAccessKeySecretRef:\n            name: aws-route53-secret-access-key-secret\n            key: secret-access-key\n---\napiVersion: certmanager.k8s.io/v1alpha1\nkind: ClusterIssuer\nmetadata:\n  name: letsencrypt-production-dns\n  namespace: cert-manager\nspec:\n  acme:\n    server: https://acme-v02.api.letsencrypt.org/directory\n    email: petr.ruzicka@gmail.com\n    privateKeySecretRef:\n      name: letsencrypt-production-dns\n    dns01:\n      providers:\n      - name: aws-route53\n        route53:\n          accessKeyID: "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${ROUTE53_AWS_ACCESS_KEY_ID}")]),e._v("\n          region: eu-central-1\n          secretAccessKeySecretRef:\n            name: aws-route53-secret-access-key-secret\n            key: secret-access-key\nEOF")]),e._v("\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("secret/aws-route53-secret-access-key-secret created\nclusterissuer.certmanager.k8s.io/letsencrypt-staging-dns created\nclusterissuer.certmanager.k8s.io/letsencrypt-production-dns created\n")])])]),a("p",[e._v("Create certificate using cert-manager:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("cat")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-f")]),e._v(" -")]),e._v("\napiVersion: certmanager.k8s.io/v1alpha1\nkind: Certificate\nmetadata:\n  name: ingress-cert-"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${LETSENCRYPT_ENVIRONMENT}")]),e._v("\n  namespace: cert-manager\nspec:\n  secretName: ingress-cert-"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${LETSENCRYPT_ENVIRONMENT}")]),e._v("\n  issuerRef:\n    kind: ClusterIssuer\n    name: letsencrypt-"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${LETSENCRYPT_ENVIRONMENT}")]),e._v('-dns\n  commonName: "*.'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${MY_DOMAIN}")]),e._v('"\n  dnsNames:\n  - "*.'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${MY_DOMAIN}")]),e._v('"\n  acme:\n    config:\n    - dns01:\n        provider: aws-route53\n      domains:\n      - "*.'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${MY_DOMAIN}")]),e._v('"\nEOF')]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sleep")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("5")]),e._v("\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("certificate.certmanager.k8s.io/ingress-cert-production created\n")])])]),a("h2",{attrs:{id:"kubed"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubed"}},[e._v("#")]),e._v(" kubed")]),e._v(" "),a("p",[e._v("Install "),a("a",{attrs:{href:"https://github.com/appscode/kubed",target:"_blank",rel:"noopener noreferrer"}},[e._v("kubed"),a("OutboundLink")],1),e._v(":")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("envsubst "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" files/flux-repository/namespaces/kubed-ns.yaml    "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" tmp/k8s-flux-repository/namespaces/kubed-ns.yaml\nenvsubst "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" files/flux-repository/releases/kubed-release.yaml "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" tmp/k8s-flux-repository/releases/kubed-release.yaml\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-C")]),e._v(" tmp/k8s-flux-repository "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--verbose")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-C")]),e._v(" tmp/k8s-flux-repository commit "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-m")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Add kubed"')]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-C")]),e._v(" tmp/k8s-flux-repository push "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-q")]),e._v("\nfluxctl "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sync")]),e._v("\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("add 'namespaces/kubed-ns.yaml'\nadd 'releases/kubed-release.yaml'\n[master fee3f31] Add kubed\n 2 files changed, 24 insertions(+)\n create mode 100644 namespaces/kubed-ns.yaml\n create mode 100644 releases/kubed-release.yaml\nSynchronizing with git@github.com:ruzickap/k8s-flux-repository\nRevision of master to apply is fee3f31\nWaiting for fee3f31 to be applied ...\nDone.\n")])])]),a("p",[e._v("Annotate (mark) the cert-manager secret to be copied to other namespaces\nif necessary:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl annotate secret ingress-cert-"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${LETSENCRYPT_ENVIRONMENT}")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-n")]),e._v(" cert-manager kubed.appscode.com/sync"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"app=kubed"')]),e._v("\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("secret/ingress-cert-production annotated\n")])])]),a("h2",{attrs:{id:"istio"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#istio"}},[e._v("#")]),e._v(" Istio")]),e._v(" "),a("p",[e._v("Install "),a("a",{attrs:{href:"https://istio.io/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Istio"),a("OutboundLink")],1),e._v(" by installing the "),a("code",[e._v("istio-init")]),e._v(":")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("envsubst "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" files/flux-repository/namespaces/istio-ns.yaml         "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" tmp/k8s-flux-repository/namespaces/istio-ns.yaml\nenvsubst "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" files/flux-repository/releases/istio-init-release.yaml "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" tmp/k8s-flux-repository/releases/istio-init-release.yaml\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-C")]),e._v(" tmp/k8s-flux-repository "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--verbose")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-C")]),e._v(" tmp/k8s-flux-repository commit "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-m")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Add Istio init"')]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-C")]),e._v(" tmp/k8s-flux-repository push "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-q")]),e._v("\nfluxctl "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sync")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sleep")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),e._v("\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("add 'namespaces/istio-ns.yaml'\nadd 'releases/istio-init-release.yaml'\n[master ff90dcd] Add Istio init\n 2 files changed, 22 insertions(+)\n create mode 100644 namespaces/istio-ns.yaml\n create mode 100644 releases/istio-init-release.yaml\nSynchronizing with git@github.com:ruzickap/k8s-flux-repository\nRevision of master to apply is ff90dcd\nWaiting for ff90dcd to be applied ...\nDone.\n")])])]),a("p",[e._v("Install "),a("a",{attrs:{href:"https://istio.io/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Istio"),a("OutboundLink")],1),e._v(":")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("envsubst "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" files/flux-repository/releases/istio-release.yaml   "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" tmp/k8s-flux-repository/releases/istio-release.yaml\nenvsubst "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" files/flux-repository/workloads/istio-gateway.yaml  "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" tmp/k8s-flux-repository/workloads/istio-gateway.yaml\nenvsubst "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" files/flux-repository/workloads/istio-services.yaml "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" tmp/k8s-flux-repository/workloads/istio-services.yaml\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-C")]),e._v(" tmp/k8s-flux-repository "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--verbose")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-C")]),e._v(" tmp/k8s-flux-repository commit "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-m")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Add Istio"')]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-C")]),e._v(" tmp/k8s-flux-repository push "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-q")]),e._v("\nfluxctl "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sync")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sleep")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("200")]),e._v("\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("add 'releases/istio-release.yaml'\nadd 'workloads/istio-gateway.yaml'\nadd 'workloads/istio-services.yaml'\n[master 6d6f49b] Add Istio\n 3 files changed, 180 insertions(+)\n create mode 100644 releases/istio-release.yaml\n create mode 100644 workloads/istio-gateway.yaml\n create mode 100644 workloads/istio-services.yaml\nSynchronizing with git@github.com:ruzickap/k8s-flux-repository\nRevision of master to apply is 6d6f49b\nWaiting for 6d6f49b to be applied ...\nDone.\n")])])]),a("p",[e._v("Create DNS record "),a("code",[e._v("mylabs.dev")]),e._v(" for the loadbalancer created by Istio:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("LOADBALANCER_HOSTNAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$(")]),e._v("kubectl get svc istio-ingressgateway "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-n")]),e._v(" istio-system "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-o")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"{.status.loadBalancer.ingress[0].hostname}"')]),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v(")")])]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("CANONICAL_HOSTED_ZONE_NAME_ID")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$(")]),e._v("aws elb describe-load-balancers "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--query")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"LoadBalancerDescriptions[?DNSName==\\'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("`")]),e._v("$LOADBALANCER_HOSTNAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("`")])]),e._v('].CanonicalHostedZoneNameID"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--output")]),e._v(" text"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v(")")])]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("HOSTED_ZONE_ID")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$(")]),e._v("aws route53 list-hosted-zones "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--query")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"HostedZones[?Name==\\'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("`")]),e._v("$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("MY_DOMAIN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("`")])]),e._v('].Id"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--output")]),e._v(" text"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v(")")])]),e._v("\n\nenvsubst "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" files/aws_route53-dns_change.json "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" aws route53 change-resource-record-sets --hosted-zone-id "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${HOSTED_ZONE_ID}")]),e._v(" --change-batch"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("file:///dev/stdin\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"ChangeInfo"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"Id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"/change/CKGC5VND57XVI"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"Status"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"PENDING"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"SubmittedAt"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"2019-08-29T07:45:55.744Z"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"Comment"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"A new record set for the zone."')]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("h2",{attrs:{id:"harbor"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#harbor"}},[e._v("#")]),e._v(" Harbor")]),e._v(" "),a("p",[e._v("Install Harbor:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("envsubst "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" files/flux-repository/namespaces/harbor-ns.yaml      "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" tmp/k8s-flux-repository/namespaces/harbor-ns.yaml\nenvsubst "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" files/flux-repository/releases/harbor-release.yaml   "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" tmp/k8s-flux-repository/releases/harbor-release.yaml\nenvsubst "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" files/flux-repository/workloads/harbor-services.yaml "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" tmp/k8s-flux-repository/workloads/harbor-services.yaml\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-C")]),e._v(" tmp/k8s-flux-repository "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--verbose")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-C")]),e._v(" tmp/k8s-flux-repository commit "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-m")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Add Harbor"')]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-C")]),e._v(" tmp/k8s-flux-repository push "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-q")]),e._v("\nfluxctl "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sync")]),e._v("\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("add 'namespaces/harbor-ns.yaml'\nadd 'releases/harbor-release.yaml'\nadd 'workloads/harbor-services.yaml'\n[master dd95b25] Add Harbor\n 3 files changed, 119 insertions(+)\n create mode 100644 namespaces/harbor-ns.yaml\n create mode 100644 releases/harbor-release.yaml\n create mode 100644 workloads/harbor-services.yaml\nSynchronizing with git@github.com:ruzickap/k8s-flux-repository\nRevision of master to apply is dd95b25\nWaiting for dd95b25 to be applied ...\nDone.\n")])])]),a("h2",{attrs:{id:"prepare-docker-images"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prepare-docker-images"}},[e._v("#")]),e._v(" Prepare docker images")]),e._v(" "),a("p",[e._v("Clone "),a("a",{attrs:{href:"https://github.com/kubernetes-up-and-running/kuard",target:"_blank",rel:"noopener noreferrer"}},[e._v("kuard"),a("OutboundLink")],1),e._v(":")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-C")]),e._v(" tmp clone https://github.com/kubernetes-up-and-running/kuard\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Cloning into 'kuard'...\nremote: Enumerating objects: 4, done.\nremote: Counting objects: 100% (4/4), done.\nremote: Compressing objects: 100% (4/4), done.\nremote: Total 1404 (delta 0), reused 4 (delta 0), pack-reused 1400\nReceiving objects: 100% (1404/1404), 2.18 MiB | 3.82 MiB/s, done.\nResolving deltas: 100% (486/486), done.\n")])])]),a("p",[e._v("Build "),a("code",[e._v("kuard")]),e._v(" container image and push it to\n"),a("code",[e._v("harbor.mylabs.dev/library/kuard:v1")]),e._v(":")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("docker")]),e._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--tag")]),e._v(" harbor."),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${MY_DOMAIN}")]),e._v("/library/kuard:v1 tmp/kuard\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("echo")]),e._v(" admin "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("docker")]),e._v(" login "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--username")]),e._v(" admin --password-stdin harbor."),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${MY_DOMAIN}")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("docker")]),e._v(" push harbor."),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${MY_DOMAIN}")]),e._v("/library/kuard:v1\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('Sending build context to Docker daemon  3.378MB\nStep 1/14 : FROM golang:1.12-alpine AS build\n1.12-alpine: Pulling from library/golang\n9d48c3bd43c5: Already exists\n7f94eaf8af20: Already exists\n9fe9984849c1: Already exists\ncf0db633a67d: Already exists\n0f7136d71739: Already exists\nDigest: sha256:e0660b4f1e68e0d408420acb874b396fc6dd25e7c1d03ad36e7d6d1155a4dff6\nStatus: Downloaded newer image for golang:1.12-alpine\n ---\x3e e0d646523991\nStep 2/14 : RUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add --no-cache git nodejs bash npm\n ---\x3e Running in baec888bed54\nfetch http://dl-cdn.alpinelinux.org/alpine/v3.10/main/x86_64/APKINDEX.tar.gz\nfetch http://dl-cdn.alpinelinux.org/alpine/v3.10/community/x86_64/APKINDEX.tar.gz\nv3.10.2-22-gb819553afa [http://dl-cdn.alpinelinux.org/alpine/v3.10/main]\nv3.10.2-20-ga23f3d183a [http://dl-cdn.alpinelinux.org/alpine/v3.10/community]\nOK: 10334 distinct packages available\nOK: 6 MiB in 15 packages\nfetch http://dl-cdn.alpinelinux.org/alpine/v3.10/main/x86_64/APKINDEX.tar.gz\nfetch http://dl-cdn.alpinelinux.org/alpine/v3.10/community/x86_64/APKINDEX.tar.gz\n(1/17) Installing ncurses-terminfo-base (6.1_p20190518-r0)\n(2/17) Installing ncurses-terminfo (6.1_p20190518-r0)\n(3/17) Installing ncurses-libs (6.1_p20190518-r0)\n(4/17) Installing readline (8.0.0-r0)\n(5/17) Installing bash (5.0.0-r0)\nExecuting bash-5.0.0-r0.post-install\n(6/17) Installing nghttp2-libs (1.39.2-r0)\n(7/17) Installing libcurl (7.65.1-r0)\n(8/17) Installing expat (2.2.7-r0)\n(9/17) Installing pcre2 (10.33-r0)\n(10/17) Installing git (2.22.0-r0)\n(11/17) Installing c-ares (1.15.0-r0)\n(12/17) Installing libgcc (8.3.0-r0)\n(13/17) Installing http-parser (2.9.2-r0)\n(14/17) Installing libstdc++ (8.3.0-r0)\n(15/17) Installing libuv (1.29.1-r0)\n(16/17) Installing nodejs (10.16.3-r0)\n(17/17) Installing npm (10.16.3-r0)\nExecuting busybox-1.30.1-r2.trigger\nOK: 83 MiB in 32 packages\nRemoving intermediate container baec888bed54\n ---\x3e a76e7141f9a2\nStep 3/14 : RUN go get -u github.com/jteeuwen/go-bindata/...\n ---\x3e Running in 3a73805b8df0\nRemoving intermediate container 3a73805b8df0\n ---\x3e e809ae1cf8bc\nStep 4/14 : WORKDIR /go/src/github.com/kubernetes-up-and-running/kuard\n ---\x3e Running in 8d4abaec72d2\nRemoving intermediate container 8d4abaec72d2\n ---\x3e 2789d5fd896f\nStep 5/14 : COPY . .\n ---\x3e 09cf2d1ce5ab\nStep 6/14 : ENV VERBOSE=0\n ---\x3e Running in 8bc543402831\nRemoving intermediate container 8bc543402831\n ---\x3e 72225f2963bb\nStep 7/14 : ENV PKG=github.com/kubernetes-up-and-running/kuard\n ---\x3e Running in ac5988e3c6e0\nRemoving intermediate container ac5988e3c6e0\n ---\x3e a553568d0612\nStep 8/14 : ENV ARCH=amd64\n ---\x3e Running in 2415a750ac6e\nRemoving intermediate container 2415a750ac6e\n ---\x3e 2ee75018db33\nStep 9/14 : ENV VERSION=test\n ---\x3e Running in 77958a3dd12e\nRemoving intermediate container 77958a3dd12e\n ---\x3e cd66dc4e3cd2\nStep 10/14 : RUN build/build.sh\n ---\x3e Running in 12a339b49a27\nVerbose: 0\n\n> webpack-cli@3.2.1 postinstall /go/src/github.com/kubernetes-up-and-running/kuard/client/node_modules/webpack-cli\n> lightercollective\n\n\n     *** Thank you for using webpack-cli! ***\n\nPlease consider donating to our open collective\n     to help us maintain this package.\n\n  https://opencollective.com/webpack/donate\n\n                    ***\n\nadded 819 packages from 505 contributors and audited 8399 packages in 12.56s\nfound 247 vulnerabilities (1 moderate, 246 high)\n  run `npm audit fix` to fix them, or `npm audit` for details\n\n> client@1.0.0 build /go/src/github.com/kubernetes-up-and-running/kuard/client\n> webpack --mode=production\n\nBrowserslist: caniuse-lite is outdated. Please run next command `npm update caniuse-lite browserslist`\nHash: 52ca742bfd1307531486\nVersion: webpack 4.28.4\nTime: 8722ms\nBuilt at: 08/29/2019 7:47:16 AM\n    Asset     Size  Chunks                    Chunk Names\nbundle.js  333 KiB       0  [emitted]  [big]  main\nEntrypoint main [big] = bundle.js\n [26] (webpack)/buildin/global.js 472 bytes {0} [built]\n[228] (webpack)/buildin/module.js 497 bytes {0} [built]\n[236] (webpack)/buildin/amd-options.js 80 bytes {0} [built]\n[252] ./src/index.jsx + 12 modules 57.6 KiB {0} [built]\n      | ./src/index.jsx 285 bytes [built]\n      | ./src/app.jsx 7.79 KiB [built]\n      | ./src/env.jsx 5.42 KiB [built]\n      | ./src/mem.jsx 5.81 KiB [built]\n      | ./src/probe.jsx 7.64 KiB [built]\n      | ./src/dns.jsx 5.1 KiB [built]\n      | ./src/keygen.jsx 7.69 KiB [built]\n      | ./src/request.jsx 3.01 KiB [built]\n      | ./src/highlightlink.jsx 1.37 KiB [built]\n      | ./src/disconnected.jsx 3.6 KiB [built]\n      | ./src/memq.jsx 6.33 KiB [built]\n      | ./src/fetcherror.js 122 bytes [built]\n      | ./src/markdown.jsx 3.46 KiB [built]\n    + 249 hidden modules\ngo: finding github.com/spf13/viper v1.3.2\ngo: finding github.com/dustin/go-humanize v1.0.0\ngo: finding github.com/pkg/errors v0.8.1\ngo: finding github.com/prometheus/client_golang v0.9.2\ngo: finding github.com/elazarl/go-bindata-assetfs v1.0.0\ngo: finding github.com/felixge/httpsnoop v1.0.0\ngo: finding github.com/miekg/dns v1.1.6\ngo: finding github.com/julienschmidt/httprouter v1.2.0\ngo: finding github.com/BurntSushi/toml v0.3.1\ngo: finding golang.org/x/crypto v0.0.0-20190313024323-a1f597ede03a\ngo: finding golang.org/x/sys v0.0.0-20190215142949-d0b11bdaac8a\ngo: finding github.com/spf13/pflag v1.0.3\ngo: finding github.com/pelletier/go-toml v1.2.0\ngo: finding github.com/coreos/go-etcd v2.0.0+incompatible\ngo: finding github.com/stretchr/testify v1.2.2\ngo: finding github.com/coreos/go-semver v0.2.0\ngo: finding github.com/spf13/jwalterweatherman v1.0.0\ngo: finding github.com/hashicorp/hcl v1.0.0\ngo: finding github.com/spf13/afero v1.1.2\ngo: finding golang.org/x/text v0.3.0\ngo: finding golang.org/x/crypto v0.0.0-20181203042331-505ab145d0a9\ngo: finding golang.org/x/sync v0.0.0-20181108010431-42b317875d0f\ngo: finding github.com/magiconair/properties v1.8.0\ngo: finding github.com/armon/consul-api v0.0.0-20180202201655-eb2c6b5be1b6\ngo: finding github.com/mitchellh/mapstructure v1.1.2\ngo: finding github.com/golang/protobuf v1.2.0\ngo: finding golang.org/x/sys v0.0.0-20181205085412-a5c9d58dba9a\ngo: finding github.com/coreos/etcd v3.3.10+incompatible\ngo: finding gopkg.in/yaml.v2 v2.2.2\ngo: finding golang.org/x/net v0.0.0-20181201002055-351d144fa1fc\ngo: finding github.com/matttproud/golang_protobuf_extensions v1.0.1\ngo: finding github.com/prometheus/common v0.0.0-20181126121408-4724e9255275\ngo: finding github.com/beorn7/perks v0.0.0-20180321164747-3a771d992973\ngo: finding github.com/prometheus/procfs v0.0.0-20181204211112-1dc9a6cbc91a\ngo: finding github.com/ugorji/go/codec v0.0.0-20181204163529-d75b2dcb6bc8\ngo: finding github.com/prometheus/client_model v0.0.0-20180712105110-5c3871d89910\ngo: finding github.com/xordataexchange/crypt v0.0.3-0.20170626215501-b2862e3d0a77\ngo: finding github.com/spf13/cast v1.3.0\ngo: finding github.com/fsnotify/fsnotify v1.4.7\ngo: finding gopkg.in/check.v1 v0.0.0-20161208181325-20d25e280405\ngo: finding github.com/davecgh/go-spew v1.1.1\ngo: finding github.com/pmezard/go-difflib v1.0.0\ngo: downloading github.com/dustin/go-humanize v1.0.0\ngo: downloading golang.org/x/crypto v0.0.0-20190313024323-a1f597ede03a\ngo: downloading github.com/spf13/pflag v1.0.3\ngo: downloading github.com/felixge/httpsnoop v1.0.0\ngo: downloading github.com/julienschmidt/httprouter v1.2.0\ngo: downloading github.com/elazarl/go-bindata-assetfs v1.0.0\ngo: downloading github.com/pkg/errors v0.8.1\ngo: extracting github.com/dustin/go-humanize v1.0.0\ngo: extracting github.com/felixge/httpsnoop v1.0.0\ngo: downloading github.com/prometheus/client_golang v0.9.2\ngo: downloading github.com/spf13/viper v1.3.2\ngo: extracting github.com/spf13/pflag v1.0.3\ngo: extracting github.com/pkg/errors v0.8.1\ngo: extracting github.com/julienschmidt/httprouter v1.2.0\ngo: extracting github.com/elazarl/go-bindata-assetfs v1.0.0\ngo: downloading github.com/miekg/dns v1.1.6\ngo: extracting github.com/spf13/viper v1.3.2\ngo: downloading github.com/mitchellh/mapstructure v1.1.2\ngo: downloading gopkg.in/yaml.v2 v2.2.2\ngo: downloading github.com/spf13/jwalterweatherman v1.0.0\ngo: downloading github.com/hashicorp/hcl v1.0.0\ngo: downloading github.com/magiconair/properties v1.8.0\ngo: downloading github.com/pelletier/go-toml v1.2.0\ngo: downloading github.com/fsnotify/fsnotify v1.4.7\ngo: extracting github.com/prometheus/client_golang v0.9.2\ngo: downloading github.com/golang/protobuf v1.2.0\ngo: extracting github.com/mitchellh/mapstructure v1.1.2\ngo: downloading github.com/prometheus/client_model v0.0.0-20180712105110-5c3871d89910\ngo: extracting github.com/spf13/jwalterweatherman v1.0.0\ngo: extracting github.com/fsnotify/fsnotify v1.4.7\ngo: downloading github.com/prometheus/common v0.0.0-20181126121408-4724e9255275\ngo: downloading github.com/prometheus/procfs v0.0.0-20181204211112-1dc9a6cbc91a\ngo: extracting github.com/magiconair/properties v1.8.0\ngo: downloading github.com/spf13/cast v1.3.0\ngo: extracting github.com/pelletier/go-toml v1.2.0\ngo: extracting gopkg.in/yaml.v2 v2.2.2\ngo: downloading github.com/spf13/afero v1.1.2\ngo: downloading golang.org/x/sys v0.0.0-20190215142949-d0b11bdaac8a\ngo: extracting github.com/hashicorp/hcl v1.0.0\ngo: extracting github.com/prometheus/client_model v0.0.0-20180712105110-5c3871d89910\ngo: extracting github.com/spf13/cast v1.3.0\ngo: downloading github.com/beorn7/perks v0.0.0-20180321164747-3a771d992973\ngo: extracting github.com/beorn7/perks v0.0.0-20180321164747-3a771d992973\ngo: extracting github.com/prometheus/common v0.0.0-20181126121408-4724e9255275\ngo: extracting github.com/spf13/afero v1.1.2\ngo: downloading golang.org/x/text v0.3.0\ngo: downloading github.com/matttproud/golang_protobuf_extensions v1.0.1\ngo: extracting github.com/prometheus/procfs v0.0.0-20181204211112-1dc9a6cbc91a\ngo: extracting github.com/matttproud/golang_protobuf_extensions v1.0.1\ngo: extracting github.com/golang/protobuf v1.2.0\ngo: extracting golang.org/x/crypto v0.0.0-20190313024323-a1f597ede03a\ngo: extracting github.com/miekg/dns v1.1.6\ngo: downloading golang.org/x/net v0.0.0-20181201002055-351d144fa1fc\ngo: extracting golang.org/x/sys v0.0.0-20190215142949-d0b11bdaac8a\ngo: extracting golang.org/x/net v0.0.0-20181201002055-351d144fa1fc\ngo: extracting golang.org/x/text v0.3.0\nRemoving intermediate container 12a339b49a27\n ---\x3e b9109e26bb7a\nStep 11/14 : FROM alpine\nlatest: Pulling from library/alpine\n9d48c3bd43c5: Already exists\nDigest: sha256:72c42ed48c3a2db31b7dafe17d275b634664a708d901ec9fd57b1529280f01fb\nStatus: Downloaded newer image for alpine:latest\n ---\x3e 961769676411\nStep 12/14 : USER nobody:nobody\n ---\x3e Running in 5537a9c9e76b\nRemoving intermediate container 5537a9c9e76b\n ---\x3e ae127ae912d6\nStep 13/14 : COPY --from=build /go/bin/kuard /kuard\n ---\x3e 7fae33a9c5b8\nStep 14/14 : CMD [ "/kuard" ]\n ---\x3e Running in 219825d3419a\nRemoving intermediate container 219825d3419a\n ---\x3e 647aa8b7809d\nSuccessfully built 647aa8b7809d\nSuccessfully tagged harbor.mylabs.dev/library/kuard:v1\nWARNING! Your password will be stored unencrypted in /home/pruzicka/.docker/config.json.\nConfigure a credential helper to remove this warning. See\nhttps://docs.docker.com/engine/reference/commandline/login/#credentials-store\n\nLogin Succeeded\nThe push refers to repository [harbor.mylabs.dev/library/kuard]\nda5d66d6f82d: Pushed\n03901b4a2ea8: Pushed\nv1: digest: sha256:907e61de499613c77579736c7a54373ffde84150cb952768cd035f81508c4b88 size: 739\n')])])]),a("p",[e._v('"Pre-build" the second docker image:')]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sed")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-i")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"s/ENV VERSION=test/ENV VERSION=new_version/"')]),e._v(" tmp/kuard/Dockerfile\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("docker")]),e._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--tag")]),e._v(" delete_me tmp/kuard\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sed")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-i")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"s/ENV VERSION=new_version/ENV VERSION=test/"')]),e._v(" tmp/kuard/Dockerfile\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('Sending build context to Docker daemon  3.378MB\nStep 1/14 : FROM golang:1.12-alpine AS build\n...\nStep 14/14 : CMD [ "/kuard" ]\n ---\x3e Running in 8cf26fdfe261\nRemoving intermediate container 8cf26fdfe261\n ---\x3e 652d18a08b2d\nSuccessfully built 652d18a08b2d\nSuccessfully tagged delete_me:latest\n')])])]),a("p",[e._v("Open these URLs to verify everything is working:")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://grafana.mylabs.dev",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://grafana.mylabs.dev"),a("OutboundLink")],1),e._v(", "),a("a",{attrs:{href:"http://grafana.mylabs.dev",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://grafana.mylabs.dev"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://jaeger.mylabs.dev",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://jaeger.mylabs.dev"),a("OutboundLink")],1),e._v(", "),a("a",{attrs:{href:"http://jaeger.mylabs.dev",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://jaeger.mylabs.dev"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://kiali.mylabs.dev",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://kiali.mylabs.dev"),a("OutboundLink")],1),e._v(", "),a("a",{attrs:{href:"http://kiali.mylabs.dev",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://kiali.mylabs.dev"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://prometheus.mylabs.dev",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://prometheus.mylabs.dev"),a("OutboundLink")],1),e._v(", "),a("a",{attrs:{href:"http://prometheus.mylabs.dev",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://prometheus.mylabs.dev"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://harbor.mylabs.dev",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://harbor.mylabs.dev"),a("OutboundLink")],1),e._v(", "),a("a",{attrs:{href:"http://harbor.mylabs.dev",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://harbor.mylabs.dev"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=n.exports}}]);
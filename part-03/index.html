<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Install basic application using Flux | Kubernetes + Flux + Istio + GitLab + Harbor</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="https://raw.githubusercontent.com/kubernetes/kubernetes/d9a58a39b69a0eaec5797e0f7a0f9472b4829ab0/logo/logo.svg">
    <meta name="description" content="Kubernetes + Flux + Istio + GitLab + Harbor">
    
    <link rel="preload" href="/k8s-flux-istio-gitlab-harbor/assets/css/0.styles.183b60b2.css" as="style"><link rel="preload" href="/k8s-flux-istio-gitlab-harbor/assets/js/app.5d525693.js" as="script"><link rel="preload" href="/k8s-flux-istio-gitlab-harbor/assets/js/2.a27de003.js" as="script"><link rel="preload" href="/k8s-flux-istio-gitlab-harbor/assets/js/1.30a6593f.js" as="script"><link rel="preload" href="/k8s-flux-istio-gitlab-harbor/assets/js/25.85328811.js" as="script"><link rel="prefetch" href="/k8s-flux-istio-gitlab-harbor/assets/js/10.340b7a91.js"><link rel="prefetch" href="/k8s-flux-istio-gitlab-harbor/assets/js/11.6724c971.js"><link rel="prefetch" href="/k8s-flux-istio-gitlab-harbor/assets/js/12.0f6b2c7f.js"><link rel="prefetch" href="/k8s-flux-istio-gitlab-harbor/assets/js/13.0f6f4ef5.js"><link rel="prefetch" href="/k8s-flux-istio-gitlab-harbor/assets/js/14.28b41666.js"><link rel="prefetch" href="/k8s-flux-istio-gitlab-harbor/assets/js/15.d3972987.js"><link rel="prefetch" href="/k8s-flux-istio-gitlab-harbor/assets/js/16.4c24402c.js"><link rel="prefetch" href="/k8s-flux-istio-gitlab-harbor/assets/js/17.6cd3a12a.js"><link rel="prefetch" href="/k8s-flux-istio-gitlab-harbor/assets/js/18.8d7e6487.js"><link rel="prefetch" href="/k8s-flux-istio-gitlab-harbor/assets/js/19.78b16bd4.js"><link rel="prefetch" href="/k8s-flux-istio-gitlab-harbor/assets/js/20.a3f134b4.js"><link rel="prefetch" href="/k8s-flux-istio-gitlab-harbor/assets/js/21.3fb0cd72.js"><link rel="prefetch" href="/k8s-flux-istio-gitlab-harbor/assets/js/22.754c2e50.js"><link rel="prefetch" href="/k8s-flux-istio-gitlab-harbor/assets/js/23.8f47d8d6.js"><link rel="prefetch" href="/k8s-flux-istio-gitlab-harbor/assets/js/24.8d82663a.js"><link rel="prefetch" href="/k8s-flux-istio-gitlab-harbor/assets/js/26.d0ce75dd.js"><link rel="prefetch" href="/k8s-flux-istio-gitlab-harbor/assets/js/27.8741302e.js"><link rel="prefetch" href="/k8s-flux-istio-gitlab-harbor/assets/js/28.3c8dbd55.js"><link rel="prefetch" href="/k8s-flux-istio-gitlab-harbor/assets/js/3.6b4152e0.js"><link rel="prefetch" href="/k8s-flux-istio-gitlab-harbor/assets/js/4.bea5e217.js"><link rel="prefetch" href="/k8s-flux-istio-gitlab-harbor/assets/js/5.ac8fedb2.js"><link rel="prefetch" href="/k8s-flux-istio-gitlab-harbor/assets/js/6.76ff54c2.js"><link rel="prefetch" href="/k8s-flux-istio-gitlab-harbor/assets/js/7.98538131.js"><link rel="prefetch" href="/k8s-flux-istio-gitlab-harbor/assets/js/vendors~docsearch.d098b00c.js">
    <link rel="stylesheet" href="/k8s-flux-istio-gitlab-harbor/assets/css/0.styles.183b60b2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/k8s-flux-istio-gitlab-harbor/" class="home-link router-link-active"><img src="https://raw.githubusercontent.com/kubernetes/kubernetes/d9a58a39b69a0eaec5797e0f7a0f9472b4829ab0/logo/logo.svg" alt="Kubernetes + Flux + Istio + GitLab + Harbor" class="logo"> <span class="site-name can-hide">Kubernetes + Flux + Istio + GitLab + Harbor</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/k8s-flux-istio-gitlab-harbor/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Links" class="dropdown-title"><span class="title">Links</span> <span class="arrow down"></span></button> <button type="button" aria-label="Links" class="mobile-dropdown-title"><span class="title">Links</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://fluxcd.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Flux
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitlab.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitLab
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://goharbor.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Harbor
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/ruzickap/k8s-flux-istio-gitlab-harbor" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/k8s-flux-istio-gitlab-harbor/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Links" class="dropdown-title"><span class="title">Links</span> <span class="arrow down"></span></button> <button type="button" aria-label="Links" class="mobile-dropdown-title"><span class="title">Links</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://fluxcd.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Flux
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitlab.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitLab
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://goharbor.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Harbor
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/ruzickap/k8s-flux-istio-gitlab-harbor" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/k8s-flux-istio-gitlab-harbor/" aria-current="page" class="sidebar-link">Kubernetes + Flux + Istio + GitLab + Harbor</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s-flux-istio-gitlab-harbor/#requirements" class="sidebar-link">Requirements</a></li><li class="sidebar-sub-header"><a href="/k8s-flux-istio-gitlab-harbor/#content" class="sidebar-link">Content</a></li><li class="sidebar-sub-header"><a href="/k8s-flux-istio-gitlab-harbor/#links" class="sidebar-link">Links</a></li></ul></li><li><a href="/k8s-flux-istio-gitlab-harbor/part-01/" class="sidebar-link">Create k8s cluster</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s-flux-istio-gitlab-harbor/part-01/#prepare-the-local-working-environment" class="sidebar-link">Prepare the local working environment</a></li><li class="sidebar-sub-header"><a href="/k8s-flux-istio-gitlab-harbor/part-01/#configure-aws" class="sidebar-link">Configure AWS</a></li><li class="sidebar-sub-header"><a href="/k8s-flux-istio-gitlab-harbor/part-01/#create-k8s-in-aws" class="sidebar-link">Create K8s in AWS</a></li></ul></li><li><a href="/k8s-flux-istio-gitlab-harbor/part-02/" class="sidebar-link">Install Helm + Flux</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s-flux-istio-gitlab-harbor/part-02/#install-helm" class="sidebar-link">Install Helm</a></li><li class="sidebar-sub-header"><a href="/k8s-flux-istio-gitlab-harbor/part-02/#install-flux" class="sidebar-link">Install Flux</a></li></ul></li><li><a href="/k8s-flux-istio-gitlab-harbor/part-03/" aria-current="page" class="active sidebar-link">Install basic application using Flux</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s-flux-istio-gitlab-harbor/part-03/#cert-manager" class="sidebar-link">cert-manager</a></li><li class="sidebar-sub-header"><a href="/k8s-flux-istio-gitlab-harbor/part-03/#kubed" class="sidebar-link">kubed</a></li><li class="sidebar-sub-header"><a href="/k8s-flux-istio-gitlab-harbor/part-03/#istio" class="sidebar-link">Istio</a></li><li class="sidebar-sub-header"><a href="/k8s-flux-istio-gitlab-harbor/part-03/#harbor" class="sidebar-link">Harbor</a></li><li class="sidebar-sub-header"><a href="/k8s-flux-istio-gitlab-harbor/part-03/#prepare-docker-images" class="sidebar-link">Prepare docker images</a></li></ul></li><li><a href="/k8s-flux-istio-gitlab-harbor/part-04/" class="sidebar-link">Flux image operations</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s-flux-istio-gitlab-harbor/part-04/#rolling-back-a-workload" class="sidebar-link">Rolling back a workload</a></li><li class="sidebar-sub-header"><a href="/k8s-flux-istio-gitlab-harbor/part-04/#image-tag-filtering" class="sidebar-link">Image Tag Filtering</a></li><li class="sidebar-sub-header"><a href="/k8s-flux-istio-gitlab-harbor/part-04/#automated-container-image-installation" class="sidebar-link">Automated container image installation</a></li><li class="sidebar-sub-header"><a href="/k8s-flux-istio-gitlab-harbor/part-04/#remove-the-applications-using-git-commit" class="sidebar-link">Remove the applications using git commit</a></li></ul></li><li><a href="/k8s-flux-istio-gitlab-harbor/part-05/" class="sidebar-link">Flux Helm Chart operations</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s-flux-istio-gitlab-harbor/part-05/#install-gitlab-using-flux" class="sidebar-link">Install GitLab using flux</a></li><li class="sidebar-sub-header"><a href="/k8s-flux-istio-gitlab-harbor/part-05/#run-and-application-via-flux-helmrelease" class="sidebar-link">Run and application via Flux &quot;HelmRelease&quot;</a></li><li class="sidebar-sub-header"><a href="/k8s-flux-istio-gitlab-harbor/part-05/#gitlab-upgrade" class="sidebar-link">GitLab upgrade</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="install-basic-application-using-flux"><a href="#install-basic-application-using-flux" class="header-anchor">#</a> Install basic application using Flux</h1> <h2 id="cert-manager"><a href="#cert-manager" class="header-anchor">#</a> cert-manager</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>envsubst <span class="token operator">&lt;</span> files/flux-repository/namespaces/cert-manager-ns.yaml     <span class="token operator">&gt;</span> tmp/k8s-flux-repository/namespaces/cert-manager-ns.yaml
envsubst <span class="token operator">&lt;</span> files/flux-repository/releases/cert-manager-release.yaml  <span class="token operator">&gt;</span> tmp/k8s-flux-repository/releases/cert-manager-release.yaml
envsubst <span class="token operator">&lt;</span> files/flux-repository/workloads/cert-manager-00-crds.yaml <span class="token operator">&gt;</span> tmp/k8s-flux-repository/workloads/cert-manager-00-crds.yaml

<span class="token function">git</span> <span class="token parameter variable">-C</span> tmp/k8s-flux-repository <span class="token function">add</span> <span class="token parameter variable">--verbose</span> <span class="token builtin class-name">.</span>
<span class="token function">git</span> <span class="token parameter variable">-C</span> tmp/k8s-flux-repository commit <span class="token parameter variable">-m</span> <span class="token string">&quot;Add cert-manager&quot;</span>
<span class="token function">git</span> <span class="token parameter variable">-C</span> tmp/k8s-flux-repository push <span class="token parameter variable">-q</span>
</code></pre></div><p>Output:</p> <div class="language-text extra-class"><pre class="language-text"><code>add 'namespaces/cert-manager-ns.yaml'
add 'releases/cert-manager-release.yaml'
add 'workloads/cert-manager-00-crds.yaml'
[master 6284194] Add cert-manager
 3 files changed, 1460 insertions(+)
 create mode 100644 namespaces/cert-manager-ns.yaml
 create mode 100644 releases/cert-manager-release.yaml
 create mode 100644 workloads/cert-manager-00-crds.yaml
</code></pre></div><p>Let Flux to sync the configuration from git repository:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sleep</span> <span class="token number">30</span>
fluxctl <span class="token function">sync</span>
</code></pre></div><p>Output:</p> <div class="language-text extra-class"><pre class="language-text"><code>Synchronizing with git@github.com:ruzickap/k8s-flux-repository
Revision of master to apply is 6284194
Waiting for 6284194 to be applied ...
Done.
</code></pre></div><p>Create <code>ClusterIssuer</code>:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">ROUTE53_AWS_SECRET_ACCESS_KEY_BASE64</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">&quot;<span class="token variable">$ROUTE53_AWS_SECRET_ACCESS_KEY</span>&quot;</span> <span class="token operator">|</span> base64<span class="token variable">)</span></span>
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">|</span> kubectl apply <span class="token parameter variable">-f</span> -</span>
apiVersion: v1
kind: Secret
metadata:
  name: aws-route53-secret-access-key-secret
  namespace: cert-manager
data:
  secret-access-key: <span class="token variable">$ROUTE53_AWS_SECRET_ACCESS_KEY_BASE64</span>
---
apiVersion: certmanager.k8s.io/v1alpha1
kind: ClusterIssuer
metadata:
  name: letsencrypt-staging-dns
  namespace: cert-manager
spec:
  acme:
    server: https://acme-staging-v02.api.letsencrypt.org/directory
    email: petr.ruzicka@gmail.com
    privateKeySecretRef:
      name: letsencrypt-staging-dns
    dns01:
      providers:
      - name: aws-route53
        route53:
          accessKeyID: <span class="token variable">${ROUTE53_AWS_ACCESS_KEY_ID}</span>
          region: eu-central-1
          secretAccessKeySecretRef:
            name: aws-route53-secret-access-key-secret
            key: secret-access-key
---
apiVersion: certmanager.k8s.io/v1alpha1
kind: ClusterIssuer
metadata:
  name: letsencrypt-production-dns
  namespace: cert-manager
spec:
  acme:
    server: https://acme-v02.api.letsencrypt.org/directory
    email: petr.ruzicka@gmail.com
    privateKeySecretRef:
      name: letsencrypt-production-dns
    dns01:
      providers:
      - name: aws-route53
        route53:
          accessKeyID: <span class="token variable">${ROUTE53_AWS_ACCESS_KEY_ID}</span>
          region: eu-central-1
          secretAccessKeySecretRef:
            name: aws-route53-secret-access-key-secret
            key: secret-access-key
EOF</span>
</code></pre></div><p>Output:</p> <div class="language-text extra-class"><pre class="language-text"><code>secret/aws-route53-secret-access-key-secret created
clusterissuer.certmanager.k8s.io/letsencrypt-staging-dns created
clusterissuer.certmanager.k8s.io/letsencrypt-production-dns created
</code></pre></div><p>Create certificate using cert-manager:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">|</span> kubectl apply <span class="token parameter variable">-f</span> -</span>
apiVersion: certmanager.k8s.io/v1alpha1
kind: Certificate
metadata:
  name: ingress-cert-<span class="token variable">${LETSENCRYPT_ENVIRONMENT}</span>
  namespace: cert-manager
spec:
  secretName: ingress-cert-<span class="token variable">${LETSENCRYPT_ENVIRONMENT}</span>
  issuerRef:
    kind: ClusterIssuer
    name: letsencrypt-<span class="token variable">${LETSENCRYPT_ENVIRONMENT}</span>-dns
  commonName: &quot;*.<span class="token variable">${MY_DOMAIN}</span>&quot;
  dnsNames:
  - &quot;*.<span class="token variable">${MY_DOMAIN}</span>&quot;
  acme:
    config:
    - dns01:
        provider: aws-route53
      domains:
      - &quot;*.<span class="token variable">${MY_DOMAIN}</span>&quot;
EOF</span>
<span class="token function">sleep</span> <span class="token number">5</span>
</code></pre></div><p>Output:</p> <div class="language-text extra-class"><pre class="language-text"><code>certificate.certmanager.k8s.io/ingress-cert-production created
</code></pre></div><h2 id="kubed"><a href="#kubed" class="header-anchor">#</a> kubed</h2> <p>Install <a href="https://github.com/appscode/kubed" target="_blank" rel="noopener noreferrer">kubed<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>envsubst <span class="token operator">&lt;</span> files/flux-repository/namespaces/kubed-ns.yaml    <span class="token operator">&gt;</span> tmp/k8s-flux-repository/namespaces/kubed-ns.yaml
envsubst <span class="token operator">&lt;</span> files/flux-repository/releases/kubed-release.yaml <span class="token operator">&gt;</span> tmp/k8s-flux-repository/releases/kubed-release.yaml

<span class="token function">git</span> <span class="token parameter variable">-C</span> tmp/k8s-flux-repository <span class="token function">add</span> <span class="token parameter variable">--verbose</span> <span class="token builtin class-name">.</span>
<span class="token function">git</span> <span class="token parameter variable">-C</span> tmp/k8s-flux-repository commit <span class="token parameter variable">-m</span> <span class="token string">&quot;Add kubed&quot;</span>
<span class="token function">git</span> <span class="token parameter variable">-C</span> tmp/k8s-flux-repository push <span class="token parameter variable">-q</span>
fluxctl <span class="token function">sync</span>
</code></pre></div><p>Output:</p> <div class="language-text extra-class"><pre class="language-text"><code>add 'namespaces/kubed-ns.yaml'
add 'releases/kubed-release.yaml'
[master fee3f31] Add kubed
 2 files changed, 24 insertions(+)
 create mode 100644 namespaces/kubed-ns.yaml
 create mode 100644 releases/kubed-release.yaml
Synchronizing with git@github.com:ruzickap/k8s-flux-repository
Revision of master to apply is fee3f31
Waiting for fee3f31 to be applied ...
Done.
</code></pre></div><p>Annotate (mark) the cert-manager secret to be copied to other namespaces
if necessary:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl annotate secret ingress-cert-<span class="token variable">${LETSENCRYPT_ENVIRONMENT}</span> <span class="token parameter variable">-n</span> cert-manager kubed.appscode.com/sync<span class="token operator">=</span><span class="token string">&quot;app=kubed&quot;</span>
</code></pre></div><p>Output:</p> <div class="language-text extra-class"><pre class="language-text"><code>secret/ingress-cert-production annotated
</code></pre></div><h2 id="istio"><a href="#istio" class="header-anchor">#</a> Istio</h2> <p>Install <a href="https://istio.io/" target="_blank" rel="noopener noreferrer">Istio<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> by installing the <code>istio-init</code>:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>envsubst <span class="token operator">&lt;</span> files/flux-repository/namespaces/istio-ns.yaml         <span class="token operator">&gt;</span> tmp/k8s-flux-repository/namespaces/istio-ns.yaml
envsubst <span class="token operator">&lt;</span> files/flux-repository/releases/istio-init-release.yaml <span class="token operator">&gt;</span> tmp/k8s-flux-repository/releases/istio-init-release.yaml

<span class="token function">git</span> <span class="token parameter variable">-C</span> tmp/k8s-flux-repository <span class="token function">add</span> <span class="token parameter variable">--verbose</span> <span class="token builtin class-name">.</span>
<span class="token function">git</span> <span class="token parameter variable">-C</span> tmp/k8s-flux-repository commit <span class="token parameter variable">-m</span> <span class="token string">&quot;Add Istio init&quot;</span>
<span class="token function">git</span> <span class="token parameter variable">-C</span> tmp/k8s-flux-repository push <span class="token parameter variable">-q</span>
fluxctl <span class="token function">sync</span>
<span class="token function">sleep</span> <span class="token number">10</span>
</code></pre></div><p>Output:</p> <div class="language-text extra-class"><pre class="language-text"><code>add 'namespaces/istio-ns.yaml'
add 'releases/istio-init-release.yaml'
[master ff90dcd] Add Istio init
 2 files changed, 22 insertions(+)
 create mode 100644 namespaces/istio-ns.yaml
 create mode 100644 releases/istio-init-release.yaml
Synchronizing with git@github.com:ruzickap/k8s-flux-repository
Revision of master to apply is ff90dcd
Waiting for ff90dcd to be applied ...
Done.
</code></pre></div><p>Install <a href="https://istio.io/" target="_blank" rel="noopener noreferrer">Istio<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>envsubst <span class="token operator">&lt;</span> files/flux-repository/releases/istio-release.yaml   <span class="token operator">&gt;</span> tmp/k8s-flux-repository/releases/istio-release.yaml
envsubst <span class="token operator">&lt;</span> files/flux-repository/workloads/istio-gateway.yaml  <span class="token operator">&gt;</span> tmp/k8s-flux-repository/workloads/istio-gateway.yaml
envsubst <span class="token operator">&lt;</span> files/flux-repository/workloads/istio-services.yaml <span class="token operator">&gt;</span> tmp/k8s-flux-repository/workloads/istio-services.yaml

<span class="token function">git</span> <span class="token parameter variable">-C</span> tmp/k8s-flux-repository <span class="token function">add</span> <span class="token parameter variable">--verbose</span> <span class="token builtin class-name">.</span>
<span class="token function">git</span> <span class="token parameter variable">-C</span> tmp/k8s-flux-repository commit <span class="token parameter variable">-m</span> <span class="token string">&quot;Add Istio&quot;</span>
<span class="token function">git</span> <span class="token parameter variable">-C</span> tmp/k8s-flux-repository push <span class="token parameter variable">-q</span>
fluxctl <span class="token function">sync</span>
<span class="token function">sleep</span> <span class="token number">200</span>
</code></pre></div><p>Output:</p> <div class="language-text extra-class"><pre class="language-text"><code>add 'releases/istio-release.yaml'
add 'workloads/istio-gateway.yaml'
add 'workloads/istio-services.yaml'
[master 6d6f49b] Add Istio
 3 files changed, 180 insertions(+)
 create mode 100644 releases/istio-release.yaml
 create mode 100644 workloads/istio-gateway.yaml
 create mode 100644 workloads/istio-services.yaml
Synchronizing with git@github.com:ruzickap/k8s-flux-repository
Revision of master to apply is 6d6f49b
Waiting for 6d6f49b to be applied ...
Done.
</code></pre></div><p>Create DNS record <code>mylabs.dev</code> for the loadbalancer created by Istio:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">LOADBALANCER_HOSTNAME</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>kubectl get svc istio-ingressgateway <span class="token parameter variable">-n</span> istio-system <span class="token parameter variable">-o</span> <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">&quot;{.status.loadBalancer.ingress[0].hostname}&quot;</span><span class="token variable">)</span></span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CANONICAL_HOSTED_ZONE_NAME_ID</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>aws elb describe-load-balancers <span class="token parameter variable">--query</span> <span class="token string">&quot;LoadBalancerDescriptions[?DNSName==\<span class="token variable"><span class="token variable">`</span>$LOADBALANCER_HOSTNAME<span class="token punctuation">\</span><span class="token variable">`</span></span>].CanonicalHostedZoneNameID&quot;</span> <span class="token parameter variable">--output</span> text<span class="token variable">)</span></span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HOSTED_ZONE_ID</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>aws route53 list-hosted-zones <span class="token parameter variable">--query</span> <span class="token string">&quot;HostedZones[?Name==\<span class="token variable"><span class="token variable">`</span>$<span class="token punctuation">{</span>MY_DOMAIN<span class="token punctuation">}</span>.<span class="token punctuation">\</span><span class="token variable">`</span></span>].Id&quot;</span> <span class="token parameter variable">--output</span> text<span class="token variable">)</span></span>

envsubst <span class="token operator">&lt;</span> files/aws_route53-dns_change.json <span class="token operator">|</span> aws route53 change-resource-record-sets --hosted-zone-id <span class="token variable">${HOSTED_ZONE_ID}</span> --change-batch<span class="token operator">=</span>file:///dev/stdin
</code></pre></div><p>Output:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;ChangeInfo&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;Id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/change/CKGC5VND57XVI&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;PENDING&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;SubmittedAt&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2019-08-29T07:45:55.744Z&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Comment&quot;</span><span class="token operator">:</span> <span class="token string">&quot;A new record set for the zone.&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="harbor"><a href="#harbor" class="header-anchor">#</a> Harbor</h2> <p>Install Harbor:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>envsubst <span class="token operator">&lt;</span> files/flux-repository/namespaces/harbor-ns.yaml      <span class="token operator">&gt;</span> tmp/k8s-flux-repository/namespaces/harbor-ns.yaml
envsubst <span class="token operator">&lt;</span> files/flux-repository/releases/harbor-release.yaml   <span class="token operator">&gt;</span> tmp/k8s-flux-repository/releases/harbor-release.yaml
envsubst <span class="token operator">&lt;</span> files/flux-repository/workloads/harbor-services.yaml <span class="token operator">&gt;</span> tmp/k8s-flux-repository/workloads/harbor-services.yaml

<span class="token function">git</span> <span class="token parameter variable">-C</span> tmp/k8s-flux-repository <span class="token function">add</span> <span class="token parameter variable">--verbose</span> <span class="token builtin class-name">.</span>
<span class="token function">git</span> <span class="token parameter variable">-C</span> tmp/k8s-flux-repository commit <span class="token parameter variable">-m</span> <span class="token string">&quot;Add Harbor&quot;</span>
<span class="token function">git</span> <span class="token parameter variable">-C</span> tmp/k8s-flux-repository push <span class="token parameter variable">-q</span>
fluxctl <span class="token function">sync</span>
</code></pre></div><p>Output:</p> <div class="language-text extra-class"><pre class="language-text"><code>add 'namespaces/harbor-ns.yaml'
add 'releases/harbor-release.yaml'
add 'workloads/harbor-services.yaml'
[master dd95b25] Add Harbor
 3 files changed, 119 insertions(+)
 create mode 100644 namespaces/harbor-ns.yaml
 create mode 100644 releases/harbor-release.yaml
 create mode 100644 workloads/harbor-services.yaml
Synchronizing with git@github.com:ruzickap/k8s-flux-repository
Revision of master to apply is dd95b25
Waiting for dd95b25 to be applied ...
Done.
</code></pre></div><h2 id="prepare-docker-images"><a href="#prepare-docker-images" class="header-anchor">#</a> Prepare docker images</h2> <p>Clone <a href="https://github.com/kubernetes-up-and-running/kuard" target="_blank" rel="noopener noreferrer">kuard<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> <span class="token parameter variable">-C</span> tmp clone https://github.com/kubernetes-up-and-running/kuard
</code></pre></div><p>Output:</p> <div class="language-text extra-class"><pre class="language-text"><code>Cloning into 'kuard'...
remote: Enumerating objects: 4, done.
remote: Counting objects: 100% (4/4), done.
remote: Compressing objects: 100% (4/4), done.
remote: Total 1404 (delta 0), reused 4 (delta 0), pack-reused 1400
Receiving objects: 100% (1404/1404), 2.18 MiB | 3.82 MiB/s, done.
Resolving deltas: 100% (486/486), done.
</code></pre></div><p>Build <code>kuard</code> container image and push it to
<code>harbor.mylabs.dev/library/kuard:v1</code>:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> build <span class="token parameter variable">--tag</span> harbor.<span class="token variable">${MY_DOMAIN}</span>/library/kuard:v1 tmp/kuard
<span class="token builtin class-name">echo</span> admin <span class="token operator">|</span> <span class="token function">docker</span> login <span class="token parameter variable">--username</span> admin --password-stdin harbor.<span class="token variable">${MY_DOMAIN}</span>
<span class="token function">docker</span> push harbor.<span class="token variable">${MY_DOMAIN}</span>/library/kuard:v1
</code></pre></div><p>Output:</p> <div class="language-text extra-class"><pre class="language-text"><code>Sending build context to Docker daemon  3.378MB
Step 1/14 : FROM golang:1.12-alpine AS build
1.12-alpine: Pulling from library/golang
9d48c3bd43c5: Already exists
7f94eaf8af20: Already exists
9fe9984849c1: Already exists
cf0db633a67d: Already exists
0f7136d71739: Already exists
Digest: sha256:e0660b4f1e68e0d408420acb874b396fc6dd25e7c1d03ad36e7d6d1155a4dff6
Status: Downloaded newer image for golang:1.12-alpine
 ---&gt; e0d646523991
Step 2/14 : RUN apk update &amp;amp;&amp;amp; apk upgrade &amp;amp;&amp;amp; apk add --no-cache git nodejs bash npm
 ---&gt; Running in baec888bed54
fetch http://dl-cdn.alpinelinux.org/alpine/v3.10/main/x86_64/APKINDEX.tar.gz
fetch http://dl-cdn.alpinelinux.org/alpine/v3.10/community/x86_64/APKINDEX.tar.gz
v3.10.2-22-gb819553afa [http://dl-cdn.alpinelinux.org/alpine/v3.10/main]
v3.10.2-20-ga23f3d183a [http://dl-cdn.alpinelinux.org/alpine/v3.10/community]
OK: 10334 distinct packages available
OK: 6 MiB in 15 packages
fetch http://dl-cdn.alpinelinux.org/alpine/v3.10/main/x86_64/APKINDEX.tar.gz
fetch http://dl-cdn.alpinelinux.org/alpine/v3.10/community/x86_64/APKINDEX.tar.gz
(1/17) Installing ncurses-terminfo-base (6.1_p20190518-r0)
(2/17) Installing ncurses-terminfo (6.1_p20190518-r0)
(3/17) Installing ncurses-libs (6.1_p20190518-r0)
(4/17) Installing readline (8.0.0-r0)
(5/17) Installing bash (5.0.0-r0)
Executing bash-5.0.0-r0.post-install
(6/17) Installing nghttp2-libs (1.39.2-r0)
(7/17) Installing libcurl (7.65.1-r0)
(8/17) Installing expat (2.2.7-r0)
(9/17) Installing pcre2 (10.33-r0)
(10/17) Installing git (2.22.0-r0)
(11/17) Installing c-ares (1.15.0-r0)
(12/17) Installing libgcc (8.3.0-r0)
(13/17) Installing http-parser (2.9.2-r0)
(14/17) Installing libstdc++ (8.3.0-r0)
(15/17) Installing libuv (1.29.1-r0)
(16/17) Installing nodejs (10.16.3-r0)
(17/17) Installing npm (10.16.3-r0)
Executing busybox-1.30.1-r2.trigger
OK: 83 MiB in 32 packages
Removing intermediate container baec888bed54
 ---&gt; a76e7141f9a2
Step 3/14 : RUN go get -u github.com/jteeuwen/go-bindata/...
 ---&gt; Running in 3a73805b8df0
Removing intermediate container 3a73805b8df0
 ---&gt; e809ae1cf8bc
Step 4/14 : WORKDIR /go/src/github.com/kubernetes-up-and-running/kuard
 ---&gt; Running in 8d4abaec72d2
Removing intermediate container 8d4abaec72d2
 ---&gt; 2789d5fd896f
Step 5/14 : COPY . .
 ---&gt; 09cf2d1ce5ab
Step 6/14 : ENV VERBOSE=0
 ---&gt; Running in 8bc543402831
Removing intermediate container 8bc543402831
 ---&gt; 72225f2963bb
Step 7/14 : ENV PKG=github.com/kubernetes-up-and-running/kuard
 ---&gt; Running in ac5988e3c6e0
Removing intermediate container ac5988e3c6e0
 ---&gt; a553568d0612
Step 8/14 : ENV ARCH=amd64
 ---&gt; Running in 2415a750ac6e
Removing intermediate container 2415a750ac6e
 ---&gt; 2ee75018db33
Step 9/14 : ENV VERSION=test
 ---&gt; Running in 77958a3dd12e
Removing intermediate container 77958a3dd12e
 ---&gt; cd66dc4e3cd2
Step 10/14 : RUN build/build.sh
 ---&gt; Running in 12a339b49a27
Verbose: 0

&gt; webpack-cli@3.2.1 postinstall /go/src/github.com/kubernetes-up-and-running/kuard/client/node_modules/webpack-cli
&gt; lightercollective


     *** Thank you for using webpack-cli! ***

Please consider donating to our open collective
     to help us maintain this package.

  https://opencollective.com/webpack/donate

                    ***

added 819 packages from 505 contributors and audited 8399 packages in 12.56s
found 247 vulnerabilities (1 moderate, 246 high)
  run `npm audit fix` to fix them, or `npm audit` for details

&gt; client@1.0.0 build /go/src/github.com/kubernetes-up-and-running/kuard/client
&gt; webpack --mode=production

Browserslist: caniuse-lite is outdated. Please run next command `npm update caniuse-lite browserslist`
Hash: 52ca742bfd1307531486
Version: webpack 4.28.4
Time: 8722ms
Built at: 08/29/2019 7:47:16 AM
    Asset     Size  Chunks                    Chunk Names
bundle.js  333 KiB       0  [emitted]  [big]  main
Entrypoint main [big] = bundle.js
 [26] (webpack)/buildin/global.js 472 bytes {0} [built]
[228] (webpack)/buildin/module.js 497 bytes {0} [built]
[236] (webpack)/buildin/amd-options.js 80 bytes {0} [built]
[252] ./src/index.jsx + 12 modules 57.6 KiB {0} [built]
      | ./src/index.jsx 285 bytes [built]
      | ./src/app.jsx 7.79 KiB [built]
      | ./src/env.jsx 5.42 KiB [built]
      | ./src/mem.jsx 5.81 KiB [built]
      | ./src/probe.jsx 7.64 KiB [built]
      | ./src/dns.jsx 5.1 KiB [built]
      | ./src/keygen.jsx 7.69 KiB [built]
      | ./src/request.jsx 3.01 KiB [built]
      | ./src/highlightlink.jsx 1.37 KiB [built]
      | ./src/disconnected.jsx 3.6 KiB [built]
      | ./src/memq.jsx 6.33 KiB [built]
      | ./src/fetcherror.js 122 bytes [built]
      | ./src/markdown.jsx 3.46 KiB [built]
    + 249 hidden modules
go: finding github.com/spf13/viper v1.3.2
go: finding github.com/dustin/go-humanize v1.0.0
go: finding github.com/pkg/errors v0.8.1
go: finding github.com/prometheus/client_golang v0.9.2
go: finding github.com/elazarl/go-bindata-assetfs v1.0.0
go: finding github.com/felixge/httpsnoop v1.0.0
go: finding github.com/miekg/dns v1.1.6
go: finding github.com/julienschmidt/httprouter v1.2.0
go: finding github.com/BurntSushi/toml v0.3.1
go: finding golang.org/x/crypto v0.0.0-20190313024323-a1f597ede03a
go: finding golang.org/x/sys v0.0.0-20190215142949-d0b11bdaac8a
go: finding github.com/spf13/pflag v1.0.3
go: finding github.com/pelletier/go-toml v1.2.0
go: finding github.com/coreos/go-etcd v2.0.0+incompatible
go: finding github.com/stretchr/testify v1.2.2
go: finding github.com/coreos/go-semver v0.2.0
go: finding github.com/spf13/jwalterweatherman v1.0.0
go: finding github.com/hashicorp/hcl v1.0.0
go: finding github.com/spf13/afero v1.1.2
go: finding golang.org/x/text v0.3.0
go: finding golang.org/x/crypto v0.0.0-20181203042331-505ab145d0a9
go: finding golang.org/x/sync v0.0.0-20181108010431-42b317875d0f
go: finding github.com/magiconair/properties v1.8.0
go: finding github.com/armon/consul-api v0.0.0-20180202201655-eb2c6b5be1b6
go: finding github.com/mitchellh/mapstructure v1.1.2
go: finding github.com/golang/protobuf v1.2.0
go: finding golang.org/x/sys v0.0.0-20181205085412-a5c9d58dba9a
go: finding github.com/coreos/etcd v3.3.10+incompatible
go: finding gopkg.in/yaml.v2 v2.2.2
go: finding golang.org/x/net v0.0.0-20181201002055-351d144fa1fc
go: finding github.com/matttproud/golang_protobuf_extensions v1.0.1
go: finding github.com/prometheus/common v0.0.0-20181126121408-4724e9255275
go: finding github.com/beorn7/perks v0.0.0-20180321164747-3a771d992973
go: finding github.com/prometheus/procfs v0.0.0-20181204211112-1dc9a6cbc91a
go: finding github.com/ugorji/go/codec v0.0.0-20181204163529-d75b2dcb6bc8
go: finding github.com/prometheus/client_model v0.0.0-20180712105110-5c3871d89910
go: finding github.com/xordataexchange/crypt v0.0.3-0.20170626215501-b2862e3d0a77
go: finding github.com/spf13/cast v1.3.0
go: finding github.com/fsnotify/fsnotify v1.4.7
go: finding gopkg.in/check.v1 v0.0.0-20161208181325-20d25e280405
go: finding github.com/davecgh/go-spew v1.1.1
go: finding github.com/pmezard/go-difflib v1.0.0
go: downloading github.com/dustin/go-humanize v1.0.0
go: downloading golang.org/x/crypto v0.0.0-20190313024323-a1f597ede03a
go: downloading github.com/spf13/pflag v1.0.3
go: downloading github.com/felixge/httpsnoop v1.0.0
go: downloading github.com/julienschmidt/httprouter v1.2.0
go: downloading github.com/elazarl/go-bindata-assetfs v1.0.0
go: downloading github.com/pkg/errors v0.8.1
go: extracting github.com/dustin/go-humanize v1.0.0
go: extracting github.com/felixge/httpsnoop v1.0.0
go: downloading github.com/prometheus/client_golang v0.9.2
go: downloading github.com/spf13/viper v1.3.2
go: extracting github.com/spf13/pflag v1.0.3
go: extracting github.com/pkg/errors v0.8.1
go: extracting github.com/julienschmidt/httprouter v1.2.0
go: extracting github.com/elazarl/go-bindata-assetfs v1.0.0
go: downloading github.com/miekg/dns v1.1.6
go: extracting github.com/spf13/viper v1.3.2
go: downloading github.com/mitchellh/mapstructure v1.1.2
go: downloading gopkg.in/yaml.v2 v2.2.2
go: downloading github.com/spf13/jwalterweatherman v1.0.0
go: downloading github.com/hashicorp/hcl v1.0.0
go: downloading github.com/magiconair/properties v1.8.0
go: downloading github.com/pelletier/go-toml v1.2.0
go: downloading github.com/fsnotify/fsnotify v1.4.7
go: extracting github.com/prometheus/client_golang v0.9.2
go: downloading github.com/golang/protobuf v1.2.0
go: extracting github.com/mitchellh/mapstructure v1.1.2
go: downloading github.com/prometheus/client_model v0.0.0-20180712105110-5c3871d89910
go: extracting github.com/spf13/jwalterweatherman v1.0.0
go: extracting github.com/fsnotify/fsnotify v1.4.7
go: downloading github.com/prometheus/common v0.0.0-20181126121408-4724e9255275
go: downloading github.com/prometheus/procfs v0.0.0-20181204211112-1dc9a6cbc91a
go: extracting github.com/magiconair/properties v1.8.0
go: downloading github.com/spf13/cast v1.3.0
go: extracting github.com/pelletier/go-toml v1.2.0
go: extracting gopkg.in/yaml.v2 v2.2.2
go: downloading github.com/spf13/afero v1.1.2
go: downloading golang.org/x/sys v0.0.0-20190215142949-d0b11bdaac8a
go: extracting github.com/hashicorp/hcl v1.0.0
go: extracting github.com/prometheus/client_model v0.0.0-20180712105110-5c3871d89910
go: extracting github.com/spf13/cast v1.3.0
go: downloading github.com/beorn7/perks v0.0.0-20180321164747-3a771d992973
go: extracting github.com/beorn7/perks v0.0.0-20180321164747-3a771d992973
go: extracting github.com/prometheus/common v0.0.0-20181126121408-4724e9255275
go: extracting github.com/spf13/afero v1.1.2
go: downloading golang.org/x/text v0.3.0
go: downloading github.com/matttproud/golang_protobuf_extensions v1.0.1
go: extracting github.com/prometheus/procfs v0.0.0-20181204211112-1dc9a6cbc91a
go: extracting github.com/matttproud/golang_protobuf_extensions v1.0.1
go: extracting github.com/golang/protobuf v1.2.0
go: extracting golang.org/x/crypto v0.0.0-20190313024323-a1f597ede03a
go: extracting github.com/miekg/dns v1.1.6
go: downloading golang.org/x/net v0.0.0-20181201002055-351d144fa1fc
go: extracting golang.org/x/sys v0.0.0-20190215142949-d0b11bdaac8a
go: extracting golang.org/x/net v0.0.0-20181201002055-351d144fa1fc
go: extracting golang.org/x/text v0.3.0
Removing intermediate container 12a339b49a27
 ---&gt; b9109e26bb7a
Step 11/14 : FROM alpine
latest: Pulling from library/alpine
9d48c3bd43c5: Already exists
Digest: sha256:72c42ed48c3a2db31b7dafe17d275b634664a708d901ec9fd57b1529280f01fb
Status: Downloaded newer image for alpine:latest
 ---&gt; 961769676411
Step 12/14 : USER nobody:nobody
 ---&gt; Running in 5537a9c9e76b
Removing intermediate container 5537a9c9e76b
 ---&gt; ae127ae912d6
Step 13/14 : COPY --from=build /go/bin/kuard /kuard
 ---&gt; 7fae33a9c5b8
Step 14/14 : CMD [ &quot;/kuard&quot; ]
 ---&gt; Running in 219825d3419a
Removing intermediate container 219825d3419a
 ---&gt; 647aa8b7809d
Successfully built 647aa8b7809d
Successfully tagged harbor.mylabs.dev/library/kuard:v1
WARNING! Your password will be stored unencrypted in /home/pruzicka/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store

Login Succeeded
The push refers to repository [harbor.mylabs.dev/library/kuard]
da5d66d6f82d: Pushed
03901b4a2ea8: Pushed
v1: digest: sha256:907e61de499613c77579736c7a54373ffde84150cb952768cd035f81508c4b88 size: 739
</code></pre></div><p>&quot;Pre-build&quot; the second docker image:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&quot;s/ENV VERSION=test/ENV VERSION=new_version/&quot;</span> tmp/kuard/Dockerfile
<span class="token function">docker</span> build <span class="token parameter variable">--tag</span> delete_me tmp/kuard
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&quot;s/ENV VERSION=new_version/ENV VERSION=test/&quot;</span> tmp/kuard/Dockerfile
</code></pre></div><p>Output:</p> <div class="language-text extra-class"><pre class="language-text"><code>Sending build context to Docker daemon  3.378MB
Step 1/14 : FROM golang:1.12-alpine AS build
...
Step 14/14 : CMD [ &quot;/kuard&quot; ]
 ---&gt; Running in 8cf26fdfe261
Removing intermediate container 8cf26fdfe261
 ---&gt; 652d18a08b2d
Successfully built 652d18a08b2d
Successfully tagged delete_me:latest
</code></pre></div><p>Open these URLs to verify everything is working:</p> <ul><li><a href="https://grafana.mylabs.dev" target="_blank" rel="noopener noreferrer">https://grafana.mylabs.dev<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="http://grafana.mylabs.dev" target="_blank" rel="noopener noreferrer">http://grafana.mylabs.dev<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://jaeger.mylabs.dev" target="_blank" rel="noopener noreferrer">https://jaeger.mylabs.dev<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="http://jaeger.mylabs.dev" target="_blank" rel="noopener noreferrer">http://jaeger.mylabs.dev<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://kiali.mylabs.dev" target="_blank" rel="noopener noreferrer">https://kiali.mylabs.dev<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="http://kiali.mylabs.dev" target="_blank" rel="noopener noreferrer">http://kiali.mylabs.dev<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://prometheus.mylabs.dev" target="_blank" rel="noopener noreferrer">https://prometheus.mylabs.dev<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="http://prometheus.mylabs.dev" target="_blank" rel="noopener noreferrer">http://prometheus.mylabs.dev<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://harbor.mylabs.dev" target="_blank" rel="noopener noreferrer">https://harbor.mylabs.dev<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="http://harbor.mylabs.dev" target="_blank" rel="noopener noreferrer">http://harbor.mylabs.dev<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ruzickap/k8s-flux-istio-gitlab-harbor/edit/master/docs/part-03/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/30/2024, 3:12:58 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/k8s-flux-istio-gitlab-harbor/part-02/" class="prev">
        Install Helm + Flux
      </a></span> <span class="next"><a href="/k8s-flux-istio-gitlab-harbor/part-04/">
        Flux image operations
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/k8s-flux-istio-gitlab-harbor/assets/js/app.5d525693.js" defer></script><script src="/k8s-flux-istio-gitlab-harbor/assets/js/2.a27de003.js" defer></script><script src="/k8s-flux-istio-gitlab-harbor/assets/js/1.30a6593f.js" defer></script><script src="/k8s-flux-istio-gitlab-harbor/assets/js/25.85328811.js" defer></script>
  </body>
</html>
